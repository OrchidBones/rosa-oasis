---
title: 伤害公式101
date: 2025-08-27 17:01:20
categories:
- [教程, RM]
tags:
- 代码
- RMMV
- RMMZ
---
# RPG Maker - 伤害公式101

*翻译自用

<br>

原始教程：[RPG Maker Forum - Damage Formula 101](https://forums.rpgmakerweb.com/index.php?threads/damage-formulas-101.81905/)

请注意：

在以下链接指向的帖子中已展开了一场关于伤害公式实例的讨论，因此请将评论和问题直接指向恰当的主题。

https://forums.rpgmakerweb.com/index.php?threads/rmmv-damage-formula-ideas-and-help.47099/

事件指令脚本列表链接：

https://forums.rpgmakerweb.com/index.php?threads/rpg-maker-mv-script-call-list.46456/

<br>

**伤害公式101**

MV版

<br>

你也许想知道如何在敌人具有某种状态时使特定技能对其伤害增大，或如何在玩家具有某种状态时治愈效果增强，或如何精准减少敌人50%的血量。

上述甚至更多的效果都可以通过自定义伤害公式来实现。

<br>

**基础**：

- **类型(Type)**：设置使用技能/物品时伤害、治愈或吸收的是HP还是MP。

  - 无 - 无伤害。

  - HP伤害 - 减少HP

  - MP伤害 - 减少MP

  - HP回复 - 回复HP

  - MP回复 - 回复MP

  - HP吸收 - 减少HP并将减少的量用于回复攻击发出者的HP

  - MP吸收 - 减少MP并将减少的量用于回复攻击发出者的MP

- **元素(Element)**：设置攻击所使用的元素。
  
  普通攻击 - 元素和武器元素一致。

- **幅度(Variance)**：伤害量将如何浮动。
  
  例如，如果技能/物品理论上会造成100点伤害，幅度是20%，那么实际造成的伤害值将在80点～120点左右。

- **能否暴击(Critical)**：能否产生暴击效果。
  
  暴击效果产生时伤害理论值将是原理论值的300%，幅度不变。

<br>

现在我们来看看真正有趣的部分——公式！

公式会决定敌方的伤害量和己方的回复量。

<br>

让我们来剖析RPG Maker MV 基础公式之一——火系魔法伤害公式，即 `100 + a.mat * 2 - b.mdf * 2`。

**a和b代表什么？**

a - 攻击发出者

b - 攻击对象

*所以如果角色格拉西斯对敌人史莱姆释放火系魔法，a指的是格拉西斯，b指的是史莱姆。*

<br>

在上述情境中，伤害量是格拉西斯的 mat (魔法攻击) 的两倍减去史莱姆的mdf (魔法防御) 的两倍再加上100。

假设格拉西斯有100点魔法攻击，史莱姆有20点魔法防御，代入上述公式后，得 100 + 100 * 2 - 20 * 2，解得对史莱姆的理论伤害量为 260 点。

<br>

**但是，公式中只有最后一个数字才会被用于计算伤害量。** 如果你有两行公式 (英文分号;会告诉程序在哪里断行)，例如 `a.atk; a.atk * 2`，只有 `a.atk * 2` 会被用于计算伤害量。

<br>

**除了a和b之外，还有其他字母可以用在伤害公式吗？**

有。例如变量。你可以在公式中这样使用变量：v[ID] 。ID 指变量ID。

所以你可以设置一个伤害量随变量值的增大而增大的技能。

```
v[10] * 2 - b.def * 3
```

<br>

**公式还能变得更复杂吗？** 比如在变量值达到100以上时执行更多伤害，这个效果可以做到吗？

可以。在这种情况下我们可以使用 if else 条件式。

if else 条件式这样写：

```
if (statement) {
    formula1;
} else {
    formula2;
}
```

**但怎么将条件式写入伤害公式呢？**

可以将整个条件式折叠成一行！

```
if (statement) { formula1; } else { formula2; }
```
例：

```
if (v[10] > 100) { a.atk*4 - b.def*2 } else { a.atk*2 - b.def*2 }
```

<br>

**如果你的伤害公式只有一行，还可以写得更短。**

```
if (statement)
    formula1;
else
    formula2;
```
例：
```
if (v[10] > 100) a.atk*4 - b.def*2; else a.atk*2 - b.def*2;
```

<br>

**使用三元运算符，你甚至可以写得更短**（我最喜欢的一种写法）：

```
statement ? formula1 : formula2;
```
例：
```
v[10] > 100 ? a.atk*4 - b.def*2 : a.atk*2 - b.def*2;
```

<br>

**条件运算符**：

\> 大于

< 小于

\>= 大于等于

<= 小于等于

=== 全等于

&& 与

|| 或

!== 不全等

! 非

<br>

实例：

```
v[10] > 100 ? 1000 : 100;
```

: 如果变量#10大于100，造成1000点伤害，否则仅造成100点伤害

```
v[10] < 100 ? 1000 : 100; 
```

: 如果变量#10小于100，造成1000点伤害，否则仅造成100点伤害

```
v[10] >== 100 ? 1000 : 100; 
```

: 如果变量#10大于等于100，造成1000点伤害，否则仅造成100点伤害

```
v[10] <== 100 ? 1000 : 100; 
```

: 如果变量#10小于等于100，造成1000点伤害，否则仅造成100点伤害

```
v[10] === 100 ? 1000: 100; 
```

: 如果变量#10等于100，造成1000点伤害，否则仅造成100点伤害

```
v[10] > 50 && v[11] >== 25 ? 1000 : 100; 
```

: 如果变量#10大于50 且 变量#11大于等于25，造成1000点伤害，否则仅造成100点伤害

```
v[10] > 50 || v[11] > 50 ? 1000 : 100; 
```

: 如果变量#10大于50 或 变量#11大于等于50，造成1000点伤害，否则仅造成100点伤害

```
v[10] !== 100 ? 1000 : 100; 
```

: 如果变量#10不等于100，造成1000点伤害，否则仅造成100点伤害

<br>

**可以用于a和b的参数有哪些？**

以下是完整的列表：

<br>

当前 (Current)：(所有统一数字，例如900, 999, 11)

<br>

level - 当前等级 (角色只会是默认值)

hp - 当前 hp

mp - 当前 mp

tp - 当前 tp

<br>

普通能力值 (Params)：(所有统一数字, e.g.: 1337, 7331, 156)

<br>

mhp - 最大 hp

mmp - 最大 MP

atk - 攻击

def - 防御

mat - 魔法攻击

mdf - 魔法防御

agi - 敏捷

luk - 幸运

<br>

额外能力值 (XParams)：(所有表示百分比的十进制数字， 例如 1.0, 0.5, 0.75, 2.44 分别是 100%, 50%, 75%, 244%)

<br>

hit - 命中率

eva - 闪避率

cri - 暴击率

cev - 暴击闪避率

mev - 魔法闪避率

mrf - 魔法反射率

cnt - 反击率

hrg - HP 再生率

mrg - MP 再生率

trg - TP 再生率

<br>

特殊能力值 (SParams)：(所有表示百分比的十进制数字， 例如 1.0, 0.5, 0.75, 2.44 分别是 100%, 50%, 75%, 244%)

<br>

tgr - 目标率

grd - 防御率

rec - 回复率

pha - 药理知识

mcr - MP 消耗率

tcr - TP 补充率

pdr - 物理伤害率

mdr - 魔法伤害率

fdr - 地形伤害率

exr - 经验率

<br>

**怎么更改HP/MP/TP值？**

<br>

gainHp(value) - 回复value大小的HP

gainMp(value) - 回复value大小的MP

gainTp(value) - 回复value大小的TP

<br>

setHp(hp) - 将HP设为指定值

setMp(mp) - 将MP设为指定值

setTp(tp) - 将TP设为指定值

```
a.setHp(a.mhp)
```
```
a.setHp(a.hp + 100)
```

<br>

clearTp() - 清除TP

<br>

**那么有没有高级的写法，能够使状态影响技能的效果呢？**

当然有！以下是所有方法：

isStateAffected(stateId) - 检查参战人员是否拥有指定ID的状态
```
b.isStateAffected(10) ? 10000 : 1;
```

<br>

isDeathStateAffected() - 检查参战人员是否拥有无法战斗状态

```
b.isDeathStateAffected() ? 10000 : 1;
```

<br>

resetStateCounts(stateId) - 刷新参战人员身上指定ID状态的效果时长

```
if (b.isStateAffected(10)) b.resetStateCounts(10); 100
```

<br>

updateStateTurns() - 将参战人员身上的所有状态的效果时长提前减少一回合

```
b.updateStateTurns(); 100
```

<br>

addState(stateId) - 给参战人员附加状态

```
if (!b.isStateAffected(10)) b.addState(10); 100
```

<br>

isStateAddable(stateId) - 检查指定ID的状态能否附加在参战人员身上

```
c=100; if (b.isStateAddable(10)) b.addState(10); else c=4000; c
```

<br>

removeState(stateId) - 从参战人员身上移除状态

```
if (a.isStateAffected(10)) a.removeState(10); 0
```

<br>

**那么增益效果呢？我们可以给参战人员附加增/减益效果吗？**

可以！

addBuff(paramId, turns) - 给某个参数添加增益效果

```
a.addBuff(0, 3); b.def*10
```

<br>

addDebuff(paramId, turns) - 给某个参数添加减益效果

```
b.addDebuff(2, 10); 9999
```

<br>

removeBuff(paramId) - 从参战人员身上移除一个增/减益效果

removeAllBuffs() - 从参战人员身上移除所有增/减益效果

<br>

**参数ID(paramId)**：

<br>

0 - 最大 HP

1 - 最大 MP

2 - 攻击

3 - 防御

4 - 魔法攻击

5 - 魔法防御

6 - 敏捷

7 - 幸运

<br>

**参战人员相关的常见函数**：

<br>

die() - 杀死参战人员 (使参战人员无法战斗)

```
b.die(); 0
```

<br>

revive() - 复活参战人员 (移除无法战斗状态)

```
a.revive(); 1000
```

<br>

paramBase(paramId) - 获取基础能力值

```
a.paramBase(3)*10 - b.def*2
```

<br>

paramPlus(paramId) - 获取额外能力值

```
a.paramPlus(3)*2 - b.def*2
```

<br>

paramMax(paramId) - 获取最大能力值

```
b.paramMax(0)
```

<br>

elementRate(elementId) - 检查参战人员的元素率 (代表百分比的十进制数字)

```
b.elementRate(10) >== 0.5 ? 10000 : a.mat*4;
```

<br>

isStateResist(stateId) - 检查参战人员对指定ID的状态具有抗性

```
c=0; b.isStateResist(10) ? c+=2000 : b.addState(10); c
```

<br>

isSkillTypeSealed(stypeId) - 检查指定ID的技能类型是否被封印

isSkillSealed(skillId) - 检查参战人员指定ID的技能是否被封印

isEquipTypeSealed(etypeId) - 检查指定ID的装备类型是否被封印

isDualWield() - 检查参战人员是否可以双持武器

isGuard() - 检查参战人员是否正在防御

recoverAll() - 移除所有状态并将HP和MP恢复到最大值

<br>

hpRate() - 检查参战人员的HP率

mpRate() - 检查参战人员的MP率

tpRate() - 检查参战人员的TP率

```
b.hpRate() < 0.5 ? b.hp-1 : 100;
```

<br>

isActor() - 检查参战人员是否为角色

isEnemy() - 检查参战人员是否为敌人

escape() - 使参战人员逃跑

b.escape() (使敌人逃跑)

<br>

consumeItem(item) - 消耗一个物品

```
a.consumeItem($dataItems[15]); 100
```

<br>

仅用于角色：

<br>

currentExp() - 当前 EXP

currentLevelExp() - 当前等级总共所需的EXP

nextLevelExp() - 下一等级总共所需的EXP

nextRequiredExp() - 从当前等级升到下一等级所需的EXP

maxLevel() - 角色最大等级

isMaxlevel() - 角色是否已达最大等级 (true/false)

hasWeapon() - 角色是否手持武器 (true/false)

hasArmor() - 角色是否佩戴装备 (true/false)

clearEquipments() - 卸下角色佩戴的所有装备

isClass(gameClass) - 角色是否是某一职业 
(gameClass - $dataClasses[ID])

hasNoWeapons() - 检查角色是否没有任何武器

levelUp() - 使角色升一级

levelDown() - 使角色降一级

gainExp(exp) - 给予角色指定数量的 EXP

learnSkill(skillId) - 使角色习得指定ID的技能

forgetSkill(skillId) - 使角色遗忘指定ID的技能

isLearnedSkill(skillId) - 检查角色是否已经习得了指定ID的技能

actorId() - 返回角色的ID

<br>

仅用于敌人：

<br>

enemyId() - 返回敌人的ID

<br>

**数学运算呢？在公式中也可以使用数学运算方式吗？**

嗯，完全可以。

Math.random() - 返回0～1之间的一个随机数 (0 <= n < 1)

Math.min(numbers) - 返回传入的所有数字中最小的一个数

```
Math.min(10, 50, 40, 200) /*会返回10。*/
```

<br>

Math.max(numbers) - 返回传入的所有数字中最大的一个数

```
Math.max(10, 50, 40, 200) /*会返回200。*/
```

<br>

Math.round(number) - 将数字四舍五入到最近的整数

Math.ceil(number) - 将数字五入到最近的整数

Math.floor(number) - 将数字四舍到最近的整数

<br>

**Math.random() 返回的是0～1之间的数，那我们可以取到 1～100 或 5～200 之间的数吗？**

<br>

没问题：

<br>

```
Math.floor(Math.random()*100)+1
```

这样写就可以返回 1～100 之间的数。如果我们不在末尾+1，就只能返回 0～99 之间的数。

<br>

**但这样写会很占地方吧？我们可以简化一下吗？**

<br>

值得庆幸的是，在 rpg_core.js 中定义了一个方法：Math.randomInt(max);

所以我们还可以这样写：

```
Math.randomInt(100)+1
```